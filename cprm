#!/usr/bin/env bash
# cprm - Project manager with directory jumping
# Usage:
#   cprm make              - Create config file
#   cprm init <name>       - Initialize project
#   cprm j <name>          - Jump to project (must use with alias)

# Get script directory (works for both bash and zsh)
if [ -n "$BASH_SOURCE" ]; then
    SCRIPT_DIR="$(command dirname "$BASH_SOURCE")"
elif [ -n "$ZSH_VERSION" ]; then
    SCRIPT_DIR="$(command dirname "${(%):-%x}")"
else
    SCRIPT_DIR="$(command dirname "$0")"
fi
SCRIPT_DIR="$(cd "$SCRIPT_DIR" && command pwd)"

# Special handling for 'j' command to enable cd
if [ "$1" = "j" ] && [ -n "$2" ]; then
    path=$(command python3 "$SCRIPT_DIR/conduit.py" j "$2")
    if [ $? -eq 0 ] && [ -n "$path" ]; then
        cd "$path"
    fi
else
    # All other commands go directly to Python and return (don't affect shell)
    command python3 "$SCRIPT_DIR/conduit.py" "$@"
    return $? 2>/dev/null || exit $?
fi
